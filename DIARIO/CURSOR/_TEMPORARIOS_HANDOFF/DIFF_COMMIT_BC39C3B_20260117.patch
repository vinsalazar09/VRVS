commit bc39c3b424da521f39ee83ee0d84abdf65b693d2
Author: vinsalazar09 <vinsalazar09@gmail.com>
Date:   Fri Jan 16 23:52:37 2026 -0300

    feat: PATCH 2/1/3 - contraste bot√£o + preservar estado render + ver respostas fim treino
    
    PATCH 2: Corrigir contraste bot√£o 'Apagar este card' (texto branco sobre fundo vermelho)
    PATCH 1: Preservar estado (colaps√°veis + scroll + √¢ncora) ap√≥s re-render em todas as fun√ß√µes
    PATCH 3: Adicionar bloco colaps√°vel 'Ver respostas' no fim do treino (normal + avalia√ß√£o)
    
    - Helpers: vrvsCaptureRenderState() e vrvsRestoreRenderState()
    - Aplicado em: renderDiario(), renderCadernoV2(), renderTarefas(), renderPendencias()
    - Sistema de √¢ncora: window.__vrvsRenderAnchorSel + data-diario-id nos cards
    - Snapshot treino normal: window.treinoLivreFimDados criado tamb√©m para treino normal
    - Bloco <details> com respostas completas (sem truncamento)
    
    CACHE_NAME: vrvs-v5.3.97-patch3-ver-respostas-fim-treino

diff --git a/docs/index.html b/docs/index.html
index 933a387..1fd01d1 100644
--- a/docs/index.html
+++ b/docs/index.html
@@ -3223,7 +3223,7 @@
                 </div>
                 
                 <div id="btnExcluirEntradaWrapper" style="display: none; margin-top: 16px;">
-                    <button type="button" class="btn btn-danger" onclick="confirmarExcluirEntradaDiario()" style="width: 100%; background: rgba(239, 68, 68, 0.2); border-color: #EF4444; color: #EF4444;">
+                    <button type="button" class="btn btn-danger" onclick="confirmarExcluirEntradaDiario()" style="width: 100%; background: #EF4444; border-color: #EF4444; color: #FFFFFF; font-weight: 800;">
                         üóëÔ∏è Apagar este card
                     </button>
                 </div>
@@ -5108,6 +5108,10 @@
             const limiteStr = limite.toISOString().split('T')[0];
             
             const container = document.getElementById('pendenciasContainer');
+            if (!container) return;
+            
+            // PATCH 1: Capturar estado antes do render
+            const renderState = vrvsCaptureRenderState(container);
             
             const pendencias = dados.filter(t => {
                 if (!t.agenda || !t.tema) return false;
@@ -5197,6 +5201,11 @@
                 </div>
                 `;
             }).join('');
+            
+            // PATCH 1: Restaurar estado completo (colaps√°veis + scroll + √¢ncora)
+            if (renderState) {
+                vrvsRestoreRenderState(container, renderState);
+            }
         }
         
         // REMOVIDO: inicializarEventListenersPendencias()
@@ -5625,6 +5634,11 @@
             const hojeStr = hojeStrLocal();
             
             const container = document.getElementById('tarefasContainer');
+            if (!container) return;
+            
+            // PATCH 1: Capturar estado antes do render
+            const renderState = vrvsCaptureRenderState(container);
+            
             let html = '';
             
             // ===== CALCULAR CONTAGEM DE DI√ÅRIO ATIVO POR TEMA (uma vez s√≥) =====
@@ -5758,6 +5772,11 @@
             });
             
             container.innerHTML = html;
+            
+            // PATCH 1: Restaurar estado completo (colaps√°veis + scroll + √¢ncora)
+            if (renderState) {
+                vrvsRestoreRenderState(container, renderState);
+            }
         }
         
         // ===== PATCH D - FUN√á√ÉO DE FILTRO DE TAREFAS =====
@@ -11911,6 +11930,12 @@
                 // Limpar flag
                 window.editandoDaSessao = false;
                 
+                // PATCH 1: Setar √¢ncora antes de renderizar
+                const entradaIdFinal = entradaId || (window.diario.entradas.length > 0 ? window.diario.entradas[window.diario.entradas.length - 1].id : null);
+                if (entradaIdFinal) {
+                    window.__vrvsRenderAnchorSel = `[data-diario-id="${entradaIdFinal}"]`;
+                }
+                
                 // Fechar modal antes de renderizar (evita conflito visual)
             fecharModalDiario();
                 
@@ -12078,12 +12103,8 @@
                 return;
             }
             
-            // TOGGLE FIX 01: Capturar estado de expans√£o antes do render
-            const estadosExpandidos = new Set();
-            container.querySelectorAll('.area-content:not(.collapsed)').forEach(el => {
-                const id = el.id;
-                if (id) estadosExpandidos.add(id);
-            });
+            // PATCH 1: Capturar estado completo (colaps√°veis + scroll + √¢ncora)
+            const renderState = vrvsCaptureRenderState(container);
             
             const filtroVista = document.getElementById('filtroDiarioVista')?.value || 'data';
             const filtroArea = document.getElementById('filtroDiarioArea')?.value || '';
@@ -12122,13 +12143,13 @@
             }
             
             if (filtroVista === 'data') {
-                renderDiarioPorData(entradasFiltradas, container, estadosExpandidos);
+                renderDiarioPorData(entradasFiltradas, container, renderState);
             } else {
-                renderDiarioPorTema(entradasFiltradas, container, estadosExpandidos);
+                renderDiarioPorTema(entradasFiltradas, container, renderState);
             }
         }
         
-        function renderDiarioPorData(entradas, container, estadosExpandidos = new Set()) {
+        function renderDiarioPorData(entradas, container, renderState = null) {
             /* === PATCH 2 - ORDENA√á√ÉO POR DATA (31/12/2025) === */
             const parseData = (entrada) => {
                 try {
@@ -12192,26 +12213,13 @@
             
             container.innerHTML = html;
             
-            // TOGGLE FIX 01: Restaurar estado de expans√£o ap√≥s render
-            estadosExpandidos.forEach(id => {
-                const content = document.getElementById(id);
-                const header = document.querySelector(`[onclick*="${id.replace('area-content-', '')}"]`);
-                if (content && header) {
-                    content.classList.remove('collapsed');
-                    header.classList.remove('collapsed');
-                    // Aplicar l√≥gica de expans√£o (max-height, display, etc.)
-                    const scrollHeight = content.scrollHeight;
-                    const viewportHeight = window.innerHeight;
-                    const maxHeightVH = Math.min(scrollHeight + 100, viewportHeight * 0.7);
-                    content.style.maxHeight = maxHeightVH + 'px';
-                    if (content.style.display === 'none') {
-                        content.style.display = '';
-                    }
-                }
-            });
+            // PATCH 1: Restaurar estado completo (colaps√°veis + scroll + √¢ncora)
+            if (renderState) {
+                vrvsRestoreRenderState(container, renderState);
+            }
         }
         
-        function renderDiarioPorTema(entradas, container, estadosExpandidos = new Set()) {
+        function renderDiarioPorTema(entradas, container, renderState = null) {
             /* === PATCH 2 - ORDENA√á√ÉO POR DATA (31/12/2025) === */
             const parseData = (entrada) => {
                 try {
@@ -12351,23 +12359,10 @@
             
             container.innerHTML = html;
             
-            // TOGGLE FIX 01: Restaurar estado de expans√£o ap√≥s render
-            estadosExpandidos.forEach(id => {
-                const content = document.getElementById(id);
-                const header = document.querySelector(`[onclick*="${id.replace('area-content-', '')}"]`);
-                if (content && header) {
-                    content.classList.remove('collapsed');
-                    header.classList.remove('collapsed');
-                    // Aplicar l√≥gica de expans√£o (max-height, display, etc.)
-                    const scrollHeight = content.scrollHeight;
-                    const viewportHeight = window.innerHeight;
-                    const maxHeightVH = Math.min(scrollHeight + 100, viewportHeight * 0.7);
-                    content.style.maxHeight = maxHeightVH + 'px';
-                    if (content.style.display === 'none') {
-                        content.style.display = '';
-                    }
-                }
-            });
+            // PATCH 1: Restaurar estado completo (colaps√°veis + scroll + √¢ncora)
+            if (renderState) {
+                vrvsRestoreRenderState(container, renderState);
+            }
         }
         
         function renderEntradaDiario(entrada) {
@@ -12386,7 +12381,7 @@
             const chipsHTML = chips.length > 0 ? `<div style="display: flex; gap: 4px; align-items: center; margin-bottom: 4px;">${chips.join('')}</div>` : '';
             
             return `
-                <div style="background: rgba(0,0,0,0.3); border-radius: 10px; padding: 14px; margin-bottom: 12px; border: 1px solid rgba(255,127,80,0.2);">
+                <div data-diario-id="${entrada.id}" style="background: rgba(0,0,0,0.3); border-radius: 10px; padding: 14px; margin-bottom: 12px; border: 1px solid rgba(255,127,80,0.2);">
                     <div style="display: flex; justify-content: space-between; align-items: start; margin-bottom: 8px;">
                         <div style="flex: 1;">
                             <div style="font-size: 12px; color: rgba(0,206,209,0.7); margin-bottom: 4px;">
@@ -13722,13 +13717,18 @@
                 resultado = calcularFeedbackTL3();
             }
             
-            // A1: Criar snapshot ANTES de limpar (para detalhes por card)
-            if (modoAvaliacao && window.treinoLivreAvaliacao && window.treinoLivreFila) {
-                window.treinoLivreFimDados = {
-                    fila: [...window.treinoLivreFila], // c√≥pia do array
-                    notas: { ...window.treinoLivreAvaliacao.notas }, // c√≥pia do objeto
-                    config: { ...window.treinoLivreAvaliacao.config } // c√≥pia do objeto
-                };
+            // PATCH 3: Criar snapshot ANTES de limpar (para detalhes por card + ver respostas)
+            // Sempre criar snapshot, tanto para avalia√ß√£o quanto para treino normal
+            if (window.treinoLivreFila && window.treinoLivreFila.length > 0) {
+                window.treinoLivreFimDados = window.treinoLivreFimDados || {};
+                window.treinoLivreFimDados.fila = [...window.treinoLivreFila]; // c√≥pia do array
+                window.treinoLivreFimDados.modo = modoAvaliacao ? 'avaliacao' : 'normal';
+                
+                // Se Modo Avalia√ß√£o, incluir notas e config
+                if (modoAvaliacao && window.treinoLivreAvaliacao) {
+                    window.treinoLivreFimDados.notas = { ...window.treinoLivreAvaliacao.notas };
+                    window.treinoLivreFimDados.config = { ...window.treinoLivreAvaliacao.config };
+                }
             }
             
             window.treinoLivreEstado = null;
@@ -13917,11 +13917,34 @@
                         </div>
                         ` : ''}
                         
+                        ${window.treinoLivreFimDados && window.treinoLivreFimDados.fila ? `
+                        <details style="margin-top: 20px; margin-bottom: 20px;">
+                            <summary style="cursor: pointer; padding: 12px; background: rgba(0,206,209,0.1); border-radius: 8px; font-size: 14px; font-weight: 600; color: var(--turquesa-light); user-select: none;">
+                                üëÅÔ∏è Ver respostas (revis√£o r√°pida)
+                            </summary>
+                            <div style="margin-top: 12px; padding: 16px; background: rgba(20,35,45,0.6); border-radius: 8px; max-height: 60vh; overflow-y: auto;">
+                                ${window.treinoLivreFimDados.fila.map((entrada, idx) => `
+                                    <div style="margin-bottom: 20px; padding-bottom: 16px; border-bottom: 1px solid rgba(255,255,255,0.1);">
+                                        <div style="font-size: 12px; color: rgba(0,206,209,0.7); margin-bottom: 8px;">
+                                            ${idx + 1}. ${escapeHtml(entrada.area || '')} ‚Ä¢ ${escapeHtml(entrada.tema || '')}
+                                        </div>
+                                        <div style="font-size: 14px; font-weight: 600; color: var(--cobre-light); margin-bottom: 8px; white-space: pre-wrap; overflow-wrap: anywhere; word-break: break-word;">
+                                            ‚ùì ${escapeHtml(entrada.topico || '(Sem t√≥pico)')}
+                                        </div>
+                                        <div style="font-size: 13px; color: rgba(255,255,255,0.9); line-height: 1.6; white-space: pre-wrap; overflow-wrap: anywhere; word-break: break-word;">
+                                            ‚úÖ ${escapeHtml(entrada.resposta || '(Sem resposta)')}
+                                        </div>
+                                    </div>
+                                `).join('')}
+                            </div>
+                        </details>
+                        ` : ''}
+                        
                         <div style="font-size: 12px; color: rgba(255,255,255,0.6); text-align: center; margin-bottom: 20px; font-style: italic;">
                             Anote o score e registre manualmente na aba Feedback, se quiser.
                         </div>
                         
-                        ${window.treinoLivreFimDados ? `
+                        ${window.treinoLivreFimDados && window.treinoLivreFimDados.modo === 'avaliacao' ? `
                         <button id="btnToggleDetalhes" class="btn" onclick="window.toggleDetalhesTreinoFim()" style="width: 100%; padding: 12px; font-size: 14px; margin-bottom: 12px; background: rgba(0, 206, 209, 0.2); border: 1px solid var(--turquesa-main);">
                             üìã Ver detalhes por card
                         </button>
@@ -13965,6 +13988,30 @@
                     <div class="treino-livre-fim-titulo">‚úì Treino conclu√≠do</div>
                     <div class="treino-livre-fim-detalhe">${total} itens revisados</div>
                     <div class="treino-livre-fim-disclaimer">(nenhuma altera√ß√£o salva)</div>
+                    
+                    ${window.treinoLivreFimDados && window.treinoLivreFimDados.fila ? `
+                    <details style="margin-top: 20px; margin-bottom: 20px;">
+                        <summary style="cursor: pointer; padding: 12px; background: rgba(0,206,209,0.1); border-radius: 8px; font-size: 14px; font-weight: 600; color: var(--turquesa-light); user-select: none;">
+                            üëÅÔ∏è Ver respostas (revis√£o r√°pida)
+                        </summary>
+                        <div style="margin-top: 12px; padding: 16px; background: rgba(20,35,45,0.6); border-radius: 8px; max-height: 60vh; overflow-y: auto;">
+                            ${window.treinoLivreFimDados.fila.map((entrada, idx) => `
+                                <div style="margin-bottom: 20px; padding-bottom: 16px; border-bottom: 1px solid rgba(255,255,255,0.1);">
+                                    <div style="font-size: 12px; color: rgba(0,206,209,0.7); margin-bottom: 8px;">
+                                        ${idx + 1}. ${escapeHtml(entrada.area || '')} ‚Ä¢ ${escapeHtml(entrada.tema || '')}
+                                    </div>
+                                    <div style="font-size: 14px; font-weight: 600; color: var(--cobre-light); margin-bottom: 8px; white-space: pre-wrap; overflow-wrap: anywhere; word-break: break-word;">
+                                        ‚ùì ${escapeHtml(entrada.topico || '(Sem t√≥pico)')}
+                                    </div>
+                                    <div style="font-size: 13px; color: rgba(255,255,255,0.9); line-height: 1.6; white-space: pre-wrap; overflow-wrap: anywhere; word-break: break-word;">
+                                        ‚úÖ ${escapeHtml(entrada.resposta || '(Sem resposta)')}
+                                    </div>
+                                </div>
+                            `).join('')}
+                        </div>
+                    </details>
+                    ` : ''}
+                    
                     <button class="btn" onclick="sairTreinoLivre()" style="padding: 12px 24px; font-size: 14px;">
                         Voltar ao Di√°rio
                     </button>
@@ -14929,6 +14976,9 @@
             const container = document.getElementById('cadernoAreasContainer');
             if (!container) return;
             
+            // PATCH 1: Capturar estado antes do render
+            const renderState = vrvsCaptureRenderState(container);
+            
             // Recarregar anota√ß√µes
             try {
                 const anotacoesSalvas = localStorage.getItem('vrvs_anotacoes');
@@ -15082,6 +15132,11 @@
             });
             
             container.innerHTML = html;
+            
+            // PATCH 1: Restaurar estado completo (colaps√°veis + scroll + √¢ncora)
+            if (renderState) {
+                vrvsRestoreRenderState(container, renderState);
+            }
         }
         
         function toggleTemaCaderno(temaId) {
@@ -15105,6 +15160,112 @@
             }
         }
         
+        // ==================== PATCH 1: HELPERS PRESERVA√á√ÉO DE ESTADO ====================
+        
+        // Vari√°vel global para √¢ncora de render
+        window.__vrvsRenderAnchorSel = null;
+        
+        // Capturar estado antes do render (colaps√°veis + scroll + √¢ncora)
+        function vrvsCaptureRenderState(container) {
+            if (!container) return null;
+            
+            const state = {
+                colapsaveis: new Set(),
+                temasExpandidos: new Set(), // Para Caderno V2
+                scrollY: window.scrollY,
+                anchorTop: null,
+                anchorSel: window.__vrvsRenderAnchorSel || null
+            };
+            
+            // Capturar √°reas expandidas (sem .collapsed)
+            container.querySelectorAll('.area-content:not(.collapsed)').forEach(el => {
+                const id = el.id;
+                if (id) state.colapsaveis.add(id);
+            });
+            
+            // Capturar temas expandidos (Caderno V2)
+            container.querySelectorAll('[id^="tema-conteudo-"]:not(.collapsed)').forEach(el => {
+                const id = el.id;
+                if (id) state.temasExpandidos.add(id);
+            });
+            
+            // Capturar posi√ß√£o da √¢ncora se existir
+            if (state.anchorSel) {
+                const anchorEl = document.querySelector(state.anchorSel);
+                if (anchorEl) {
+                    state.anchorTop = anchorEl.getBoundingClientRect().top + window.scrollY;
+                }
+            }
+            
+            return state;
+        }
+        
+        // Restaurar estado ap√≥s o render
+        function vrvsRestoreRenderState(container, state) {
+            if (!container || !state) return;
+            
+            // Restaurar √°reas expandidas
+            state.colapsaveis.forEach(id => {
+                const content = document.getElementById(id);
+                const header = document.querySelector(`[onclick*="${id.replace('area-content-', '')}"]`);
+                if (content && header) {
+                    content.classList.remove('collapsed');
+                    header.classList.remove('collapsed');
+                    // Aplicar max-height se necess√°rio
+                    if (content.scrollHeight > 0) {
+                        const scrollHeight = content.scrollHeight;
+                        const viewportHeight = window.innerHeight;
+                        const maxHeightVH = Math.min(scrollHeight + 100, viewportHeight * 0.7);
+                        content.style.maxHeight = maxHeightVH + 'px';
+                    }
+                    if (content.style.display === 'none') {
+                        content.style.display = '';
+                    }
+                }
+            });
+            
+            // Restaurar temas expandidos (Caderno V2)
+            state.temasExpandidos.forEach(id => {
+                const conteudo = document.getElementById(id);
+                if (conteudo) {
+                    conteudo.classList.remove('collapsed');
+                    conteudo.style.maxHeight = '';
+                    conteudo.style.display = 'block';
+                    conteudo.style.overflow = 'visible';
+                }
+            });
+            
+            // Restaurar scroll/√¢ncora
+            if (state.anchorSel && state.anchorTop !== null) {
+                const anchorEl = document.querySelector(state.anchorSel);
+                if (anchorEl) {
+                    const topAfter = anchorEl.getBoundingClientRect().top + window.scrollY;
+                    const delta = topAfter - state.anchorTop;
+                    window.scrollTo({
+                        top: state.scrollY + delta,
+                        behavior: 'instant'
+                    });
+                } else {
+                    // Fallback: restaurar scroll Y original
+                    window.scrollTo({
+                        top: state.scrollY,
+                        behavior: 'instant'
+                    });
+                }
+            } else {
+                // Sem √¢ncora: restaurar scroll Y original
+                window.scrollTo({
+                    top: state.scrollY,
+                    behavior: 'instant'
+                });
+            }
+            
+            // Limpar √¢ncora ap√≥s uso
+            window.__vrvsRenderAnchorSel = null;
+        }
+        
+        // ==================== FIM PATCH 1 HELPERS ====================
+        
         function toggleAreaCaderno(areaId) {
             const header = document.querySelector(`[onclick="toggleAreaCaderno('${areaId}')"]`);
             const content = document.getElementById(`area-content-${areaId}`);
diff --git a/docs/sw.js b/docs/sw.js
index 0fc6961..8683e91 100644
--- a/docs/sw.js
+++ b/docs/sw.js
@@ -1,6 +1,6 @@
 // Service Worker para VRVS - Funcionamento Offline
 // ATUALIZAR ESTA VERS√ÉO SEMPRE QUE FIZER MUDAN√áAS PARA FOR√áAR ATUALIZA√á√ÉO
-const CACHE_NAME = "vrvs-v5.3.94-backup-raw-export-ui";
+const CACHE_NAME = "vrvs-v5.3.97-patch3-ver-respostas-fim-treino";
 
 // Arquivos essenciais para cache
 const FILES_TO_CACHE = [
